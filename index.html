<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <link href="https://vjs.zencdn.net/7.6.6/video-js.css" rel="stylesheet" />
    <script src="https://vjs.zencdn.net/7.6.6/video.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
        }

        #container {
            height: 100vh;
            width: 100vw;
        }

        #second_player {
            display: none;
        }

        #stream-info {
            position: absolute;
            left: 0;
            bottom: 0;
            color: white;
        }

        
    </style>
</head>

<body>
    <div id="container">
        <video autoplay id="first_player" class="video-js vjs-fill" muted></video>
        <video autoplay id="second_player" class="video-js vjs-fill" muted></video>
    </div>

    <div id="stream-info">
        <p id="stream-name"></p>
        <p id="stream-desc"></p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.dev.js"></script>
    <script>
        // Consts
        const streams = [
            "http://qthttp.apple.com.edgesuite.net/1010qwoeiuryfg/sl.m3u8",
            "http://d2zihajmogu5jn.cloudfront.net/bipbop-advanced/bipbop_16x9_variant.m3u8",
            "http://demo.unified-streaming.com/video/tears-of-steel/tears-of-steel.ism/.m3u8"
        ];
        const firstPlayer = videojs("first_player");
        const secondPlayer = videojs("second_player");
        const changeRate = 3;
        const socket = io.connect("http://localhost:3000");

        // Dynamic variables
        let currentPlayer = firstPlayer;
        let nextPlayer = secondPlayer;
        let index = 1;

		main();

		/////////////////////////
		//      functions      //
		/////////////////////////
		
		function main() {
			socket.on("change-stream", data => {
				index = data;
				cycle();
			});

			currentPlayer.src({
				src: streams[0],
				type: "application/x-mpegURL"
			});
		}
		
        function cycle() {
            nextPlayer.src({
                src: streams[index],
                type: "application/x-mpegURL"
            });

            let checkInterval = setInterval(() => {
                if (nextPlayer.readyState() === 4) {
                    clearInterval(checkInterval);
                    document.getElementById(currentPlayer.id()).style.display = "none";
                    document.getElementById(nextPlayer.id()).style.display = "block";
                    const temp = nextPlayer;
                    nextPlayer = currentPlayer;
                    currentPlayer = temp;
					socket.emit("stream-changed");
                }
            }, 250);
        }
    </script>
</body>

</html>